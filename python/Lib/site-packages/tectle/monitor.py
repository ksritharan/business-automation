from .db import get_connection, get_data_dict
from flask import render_template, url_for, make_response
import requests
import traceback
import logging
from math import ceil, sqrt
logger = logging.getLogger()

def do_monitor():
    context = {'monitor_page': True}
    conn = get_connection()
    cur = conn.cursor()
    query = """
        SELECT id,
               COALESCE(name, printer_ip) name,
               rtsp_url
          FROM printers
    """
    printers = get_data_dict(cur, query)
    grid_width = 6
    remainder = len(printers) % grid_width
    if remainder != 0:
        for _ in range(grid_width - remainder):
            printers.append({})
    
    context['printers'] = printers
    context['grid_width'] = grid_width
    
    return render_template('monitor.html', **context)

    
    