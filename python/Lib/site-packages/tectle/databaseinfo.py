from .db import get_connection, get_data
from flask import render_template, url_for

def do_db_info():
    context = {'db': True}
    conn = get_connection()
    cur = conn.cursor()
    column_names, rows = get_data(cur, "SELECT * FROM PRINTERS")
    context['printers_cols'] = column_names
    context['printers_rows'] = rows
    column_names, rows = get_data(cur, "SELECT * FROM PRINTER_QUEUE ORDER BY PRINTER_ID, PRIORITY")
    context['printer_queue_cols'] = column_names
    context['printer_queue_rows'] = rows
    column_names, rows = get_data(cur, "SELECT * FROM PRINTER_QUEUE WHERE PRINTER_ID IS NULL")
    context['unassigned_queue_cols'] = column_names
    context['unassigned_queue_rows'] = rows
    return render_template('db.html', **context)

